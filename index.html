<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
    </style>
    <title>Animacja Słonia w Obie Strony</title>
</head>
<body>
    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const player = {
            x: canvas.width / 2,
            y: canvas.height / 2,
            width: 50,
            height: 50,
            speed: 5,
            standingImageRight: "images/tutu/right/sprite_walk_right0.png",
            standingImageLeft: "images/tutu/left/sprite_left0.png",
            standingImageBack: "images/tutu/back/sprite_back0.png",
            standingImageFront: "images/tutu/front/sprite_front0.png",
            runSpritesRight: [
                "images/tutu/right/sprite_walk_right0.png",
                "images/tutu/right/sprite_walk_right1.png",
                "images/tutu/right/sprite_walk_right2.png",
                "images/tutu/right/sprite_walk_right3.png",
                "images/tutu/right/sprite_walk_right4.png",
                "images/tutu/right/sprite_walk_right5.png",
            ],
            runSpritesLeft: [
                "images/tutu/left/sprite_left0.png",
                "images/tutu/left/sprite_left1.png",
                "images/tutu/left/sprite_left2.png",
                "images/tutu/left/sprite_left3.png",
                "images/tutu/left/sprite_left4.png",
                "images/tutu/left/sprite_left5.png",
            ],
            runSpritesBack: [
                "images/tutu/back/sprite_back0.png",
                "images/tutu/back/sprite_back1.png",
                "images/tutu/back/sprite_back2.png",
                "images/tutu/back/sprite_back3.png",
                "images/tutu/back/sprite_back4.png",
                "images/tutu/back/sprite_back5.png",
                "images/tutu/back/sprite_back6.png",
                "images/tutu/back/sprite_back7.png",
            ],
            runSpritesFront: [
                "images/tutu/front/sprite_front0.png",
                "images/tutu/front/sprite_front1.png",
                "images/tutu/front/sprite_front2.png",
                "images/tutu/front/sprite_front3.png",
                "images/tutu/front/sprite_front4.png",
                "images/tutu/front/sprite_front5.png",
                "images/tutu/front/sprite_front6.png",
                "images/tutu/front/sprite_front7.png",
            ],
            currentFrame: 0,
            animationInterval: null,
            direction: "right"
        };

        const keys = {};

        function loadImages(imageArray) {
            const promises = [];
            for (let i = 0; i < imageArray.length; i++) {
                const img = new Image();
                img.src = imageArray[i];
                promises.push(new Promise((resolve, reject) => {
                    img.onload = resolve;
                    img.onerror = reject;
                }));
            }
            return Promise.all(promises);
        }

        loadImages([
            ...player.runSpritesRight,
            player.standingImageRight,
            ...player.runSpritesLeft,
            player.standingImageLeft,
            ...player.runSpritesBack,
            player.standingImageBack,
            ...player.runSpritesFront,
            player.standingImageFront,
        ])
        .then(() => {
            window.addEventListener("keydown", function (event) {
                keys[event.key] = true;
            });

            window.addEventListener("keyup", function (event) {
                keys[event.key] = false;
            });

            function gameLoop() {
                if (keys['w']) {
                    player.y -= player.speed;
                    player.direction = "back";
                    startAnimation(player.runSpritesBack);
                }
                if (keys['s']) {
                    player.y += player.speed;
                    player.direction = "front";
                    startAnimation(player.runSpritesFront);
                }
                if (keys['a']) {
                    player.x -= player.speed;
                    player.direction = "left";
                    startAnimation(player.runSpritesLeft);
                }
                if (keys['d']) {
                    player.x += player.speed;
                    player.direction = "right";
                    startAnimation(player.runSpritesRight);
                }

                ctx.clearRect(0, 0, canvas.width, canvas.height);

                if (!keys['a'] && !keys['d'] && !keys['w'] && !keys['s']) {
                    drawPlayerStanding();
                } else {
                    drawPlayerWithSprite();
                }

                requestAnimationFrame(gameLoop);
            }

            function startAnimation(spriteArray) {
                if (!player.animationInterval) {
                    player.animationInterval = setInterval(function () {
                        player.currentFrame = (player.currentFrame + 1) % spriteArray.length;
                    }, 150); 
                }
            }

            function drawPlayerStanding() {
                const img = new Image();
                if (player.direction === "right") {
                    img.src = player.standingImageRight;
                } else if (player.direction === "left") {
                    img.src = player.standingImageLeft;
                } else if (player.direction === "back") {
                    img.src = player.standingImageBack;
                } else if (player.direction === "front") {
                    img.src = player.standingImageFront;
                }
                ctx.drawImage(img, player.x - player.width / 2, player.y - player.height / 2, player.width, player.height);
                stopAnimation();
            }

            function drawPlayerWithSprite() {
                let spriteArray;
                if (player.direction === "right") {
                    spriteArray = player.runSpritesRight;
                } else if (player.direction === "left") {
                    spriteArray = player.runSpritesLeft;
                } else if (player.direction === "back") {
                    spriteArray = player.runSpritesBack;
                } else if (player.direction === "front") {
                    spriteArray = player.runSpritesFront;
                }

                const img = new Image();
                img.src = spriteArray[player.currentFrame];
                ctx.drawImage(img, player.x - player.width / 2, player.y - player.height / 2, player.width, player.height);
            }

            function stopAnimation() {
                if (player.animationInterval) {
                    clearInterval(player.animationInterval);
                    player.animationInterval = null;
                    player.currentFrame = 0;
                }
            }

            requestAnimationFrame(gameLoop);
        })
        .catch((error) => {
            console.error("Wystąpił błąd podczas wczytywania obrazów:", error);
        });
    </script>
</body>
</html>
